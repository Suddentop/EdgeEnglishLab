# 🔐 PHP API Proxy 보안 설정
# php_api_proxy 폴더 전용 .htaccess

# ===========================================
# 보안 설정 - 민감한 파일 접근 차단
# ===========================================

# 환경 변수 파일 접근 차단
<Files "config.php">
    Order Allow,Deny
    Deny from all
</Files>

<Files ".env*">
    Order Allow,Deny
    Deny from all
</Files>

<Files "load-env.php">
    Order Allow,Deny
    Deny from all
</Files>

# API 로그 파일 접근 차단
<Files "api_logs.txt">
    Order Allow,Deny
    Deny from all
</Files>

<Files "rate_limit.json">
    Order Allow,Deny
    Deny from all
</Files>

# 서버 설정 가이드 접근 차단
<Files "SERVER_ENV_SETUP.txt">
    Order Allow,Deny
    Deny from all
</Files>

<Files "env-example.txt">
    Order Allow,Deny
    Deny from all
</Files>

# 디렉토리 브라우징 비활성화
Options -Indexes

# ===========================================
# PHP 설정
# ===========================================

# PHP 에러 로그 활성화
php_flag log_errors on
php_value error_log "api_logs.txt"

# 요청 크기 제한 (10MB)
LimitRequestBody 10485760

# 타임아웃 설정
php_value max_execution_time 60
php_value max_input_time 60
php_value memory_limit 256M

# 업로드 크기 제한
php_value upload_max_filesize 10M
php_value post_max_size 10M

# ===========================================
# CORS 설정 (개발 환경 포함)
# ===========================================

<IfModule mod_headers.c>
    # CORS는 PHP 파일에서 동적으로 처리됨
    # 여기서는 추가 보안 헤더만 설정
    
    # XSS 보호
    Header always set X-XSS-Protection "1; mode=block"
    
    # 클릭재킹 방지
    Header always set X-Frame-Options "DENY"
    
    # MIME 타입 스니핑 방지
    Header always set X-Content-Type-Options "nosniff"
    
    # HTTPS 강제 (선택사항)
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# ===========================================
# OPTIONS 요청 처리 (CORS Preflight)
# ===========================================

RewriteEngine On
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

