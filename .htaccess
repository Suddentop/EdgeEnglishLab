# ğŸš€ edgeenglish.net ì •ì  ì‚¬ì´íŠ¸ ë°°í¬ìš© .htaccess
# dothome.co.kr í˜¸ìŠ¤íŒ… ìµœì í™” ì„¤ì •

# ===========================================
# ë³´ì•ˆ ì„¤ì •
# ===========================================

# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ì ‘ê·¼ ì°¨ë‹¨
<Files "config.php">
    Order Allow,Deny
    Deny from all
</Files>

<Files ".env*">
    Order Allow,Deny
    Deny from all
</Files>

# API ë¡œê·¸ íŒŒì¼ ì ‘ê·¼ ì°¨ë‹¨
<Files "api_logs.txt">
    Order Allow,Deny
    Deny from all
</Files>

<Files "rate_limit.json">
    Order Allow,Deny
    Deny from all
</Files>

# ë””ë ‰í† ë¦¬ ë¸Œë¼ìš°ì§• ë¹„í™œì„±í™”
Options -Indexes

# PHP ì—ëŸ¬ ë¡œê·¸ í™œì„±í™”
php_flag log_errors on
php_value error_log "api_logs.txt"

# ===========================================
# CORS ì„¤ì • (API í”„ë¡ì‹œìš©)
# ===========================================
<IfModule mod_headers.c>
    Header always set Access-Control-Allow-Origin "https://edgeenglish.net"
    Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
    Header always set Access-Control-Max-Age "86400"
</IfModule>

# OPTIONS ìš”ì²­ ì²˜ë¦¬
RewriteEngine On
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# ===========================================
# React Router ì§€ì› (SPA ë¼ìš°íŒ…)
# ===========================================
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # API í”„ë¡ì‹œ íŒŒì¼ì€ ì§ì ‘ ì ‘ê·¼ í—ˆìš©
    RewriteCond %{REQUEST_URI} !^/(api-proxy\.php|secure-api-proxy\.php|test-api\.php)$
    
    # ì •ì  íŒŒì¼ì´ ì•„ë‹Œ ê²½ìš° index.htmlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.html [L]
</IfModule>

# ===========================================
# ì„±ëŠ¥ ìµœì í™”
# ===========================================

# Gzip ì••ì¶• í™œì„±í™”
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# ë¸Œë¼ìš°ì € ìºì‹± ì„¤ì •
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# ===========================================
# PHP ì„¤ì • (API í”„ë¡ì‹œìš©)
# ===========================================

# ìš”ì²­ í¬ê¸° ì œí•œ (10MB)
LimitRequestBody 10485760

# íƒ€ì„ì•„ì›ƒ ì„¤ì •
php_value max_execution_time 60
php_value max_input_time 60
php_value memory_limit 256M

# ì—…ë¡œë“œ í¬ê¸° ì œí•œ
php_value upload_max_filesize 10M
php_value post_max_size 10M

# ===========================================
# ë³´ì•ˆ í—¤ë”
# ===========================================
<IfModule mod_headers.c>
    # XSS ë³´í˜¸
    Header always set X-XSS-Protection "1; mode=block"
    
    # í´ë¦­ì¬í‚¹ ë°©ì§€
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # MIME íƒ€ì… ìŠ¤ë‹ˆí•‘ ë°©ì§€
    Header always set X-Content-Type-Options "nosniff"
    
    # HTTPS ê°•ì œ (ì„ íƒì‚¬í•­)
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>