# 배포 사이트 문제 해결 가이드

## 🚨 현재 상황
- ✅ 개발 서버 (`localhost:3000`): 정상 작동
- ❌ 배포 사이트 (`edgeenglish.net`): 이미지 처리 실패

## 🔍 문제 원인

### 가능성 1: 서버의 빌드 파일이 구버전 ⭐ 가장 가능성 높음
배포된 사이트의 JS 파일이 **프록시 URL이 없는 이전 빌드 버전**일 수 있습니다.

**확인 방법**:
1. 배포 사이트 접속: `https://edgeenglish.net`
2. F12 → Sources 탭
3. `static/js/main.[해시].js` 파일 확인
4. 파일 이름이 `main.f61bd10e.js`인지 확인

**예상 문제**:
- 서버: `main.c63f75a5.js` (구버전 - 프록시 URL 없음)
- 로컬: `main.f61bd10e.js` (신버전 - 프록시 URL 포함)

### 가능성 2: index.html이 캐시된 구버전 참조
`index.html`이 구버전 JS 파일을 참조하고 있을 수 있습니다.

---

## ✅ 해결 방법

### 1단계: 서버에 올린 파일 확인

FTP로 서버 접속 후:

```
/public_html/
├── index.html              ← 확인 필요
└── static/
    └── js/
        ├── main.f61bd10e.js    ← 이 파일이 있어야 함
        └── main.c63f75a5.js    ← 구버전 (삭제 필요)
```

**index.html 내용 확인**:
```html
<!-- 이것이 있어야 함 -->
<script defer="defer" src="/static/js/main.f61bd10e.js"></script>

<!-- 이것이 있으면 구버전 (문제!) -->
<script defer="defer" src="/static/js/main.c63f75a5.js"></script>
```

### 2단계: 최신 빌드 파일 재업로드

#### A. 안전한 방법 (권장)
```
1. FTP로 서버 접속
2. /public_html/ 폴더의 모든 파일 삭제 (php_api_proxy 제외!)
3. 로컬 D:\Dev\engquiz\build\* 의 모든 파일 업로드
4. 브라우저 캐시 강제 새로고침 (Ctrl+Shift+R)
```

#### B. 빠른 방법
```
1. FTP로 서버 접속
2. /public_html/index.html 삭제 후 재업로드
3. /public_html/static/js/main.*.js 모두 삭제 후 재업로드
4. 브라우저 캐시 강제 새로고침 (Ctrl+Shift+R)
```

### 3단계: 브라우저 캐시 완전 삭제

#### Chrome/Edge
```
1. F12 → Network 탭
2. "Disable cache" 체크
3. 빈 영역 우클릭 → "Empty Cache and Hard Reload"
또는
4. Ctrl+Shift+Delete → 캐시 이미지 및 파일 삭제
```

---

## 🧪 테스트 절차

### 1. 배포 사이트 JS 파일 확인
```
https://edgeenglish.net
→ F12 → Sources
→ static/js/main.f61bd10e.js 존재 확인
```

### 2. 콘솔에서 환경변수 확인
```javascript
// F12 → Console에서 실행
console.log(process.env.REACT_APP_API_PROXY_URL)
```

**예상 결과**:
```
"https://edgeenglish.net/php_api_proxy/api-proxy.php"
```

**문제가 있을 경우**:
```
undefined  ← 구버전 빌드!
```

### 3. 이미지 처리 테스트
```
1. Work #01 선택
2. 이미지 붙여넣기 또는 파일 첨부
3. F12 → Console 확인
```

**성공 시**:
```
🔍 환경 변수 확인:
  proxyUrl: 설정됨
  directApiKey: 없음

🤖 OpenAI 프록시 서버 호출 중...
✅ 200 OK
```

**실패 시**:
```
🔍 환경 변수 확인:
  proxyUrl: 없음          ← 구버전!
  directApiKey: 없음

❌ API Key가 설정되지 않았습니다
```

---

## 🔄 재빌드 및 재배포 (필요시)

혹시 로컬 빌드에 문제가 있다면:

```powershell
cd D:\Dev\engquiz

# 1. .env.local 백업
Rename-Item .env.local .env.local.backup -ErrorAction SilentlyContinue

# 2. 기존 빌드 삭제
Remove-Item -Recurse -Force build

# 3. 캐시 삭제
Remove-Item -Recurse -Force node_modules\.cache -ErrorAction SilentlyContinue

# 4. 빌드 수행
npm run build

# 5. .env.local 복원
Rename-Item .env.local.backup .env.local -ErrorAction SilentlyContinue

# 6. 빌드 검증
Select-String -Path "build\static\js\main.*.js" -Pattern "edgeenglish.net/php_api_proxy"
```

**예상 출력**:
```
build\static\js\main.f61bd10e.js:1:...edgeenglish.net/php_api_proxy/api-proxy.php...
```

---

## 📋 체크리스트

### 로컬 빌드 확인
- [x] `.env.production.local` 파일에 `REACT_APP_API_PROXY_URL` 설정됨
- [x] `build/static/js/main.f61bd10e.js` 파일 생성됨
- [x] 빌드 파일에 프록시 URL 포함됨 (1회)
- [x] 빌드 파일에 API 키 노출 없음 (0회)

### 서버 배포 확인
- [ ] FTP로 서버 접속
- [ ] `/public_html/index.html`이 최신 버전인지 확인
- [ ] `/public_html/static/js/main.f61bd10e.js` 존재 확인
- [ ] 구버전 JS 파일 삭제 (`main.c63f75a5.js` 등)
- [ ] 브라우저 캐시 강제 삭제 (Ctrl+Shift+R)

### 테스트
- [ ] 배포 사이트에서 F12 → Sources → `main.f61bd10e.js` 확인
- [ ] 콘솔에서 `process.env.REACT_APP_API_PROXY_URL` 확인
- [ ] Work #01에서 이미지 처리 테스트
- [ ] 콘솔에 "프록시 서버 호출 중..." 메시지 확인

---

## 🆘 여전히 문제가 있을 경우

### 확인 사항 1: 서버의 JS 파일 이름
```
배포 사이트 → F12 → Sources → static/js/
```
→ 스크린샷으로 파일 이름 확인

### 확인 사항 2: index.html 내용
```
배포 사이트 → F12 → Sources → index.html
```
→ `<script>` 태그에서 참조하는 JS 파일 이름 확인

### 확인 사항 3: 콘솔 에러 메시지
```
배포 사이트 → Work #01 → 이미지 붙여넣기 → F12 → Console
```
→ 전체 에러 메시지 복사

---

## 🎯 핵심 요약

**문제**: 서버에 올린 빌드 파일이 **구버전**
**해결**: 최신 빌드 파일 (`main.f61bd10e.js`) 재업로드 + 캐시 삭제

**최신 빌드 특징**:
- ✅ 프록시 URL 포함
- ✅ API 키 노출 없음
- ✅ 파일명: `main.f61bd10e.js`

**구버전 빌드 특징**:
- ❌ 프록시 URL 없음
- ❌ API 키 노출 가능
- ❌ 파일명: `main.c63f75a5.js` 등




