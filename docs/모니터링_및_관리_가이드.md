# ğŸ“Š dothome.co.kr ë°±ì—”ë“œ ì„œë²„ ëª¨ë‹ˆí„°ë§ ë° ê´€ë¦¬ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

dothome.co.kr PHP ë°±ì—”ë“œ ì„œë²„ì˜ ì„±ëŠ¥, ë³´ì•ˆ, ì‚¬ìš©ëŸ‰ì„ íš¨ê³¼ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ìƒì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ¯ ëª¨ë‹ˆí„°ë§ ëª©í‘œ

### í•µì‹¬ ì§€í‘œ (KPI)
- **ê°€ìš©ì„±**: 99.9% ì´ìƒ
- **ì‘ë‹µ ì‹œê°„**: í‰ê·  5ì´ˆ ì´ë‚´
- **ì„±ê³µë¥ **: 99% ì´ìƒ
- **ì—ëŸ¬ìœ¨**: 1% ì´í•˜
- **ë³´ì•ˆ ì‚¬ê³ **: 0ê±´

### ëª¨ë‹ˆí„°ë§ ë²”ìœ„
- âœ… **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì‘ë‹µ ì‹œê°„, ì²˜ë¦¬ëŸ‰, ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
- âœ… **ë³´ì•ˆ ëª¨ë‹ˆí„°ë§**: ì¹¨ì… íƒì§€, ë¹„ì •ìƒ ì ‘ê·¼, ë³´ì•ˆ ì´ë²¤íŠ¸
- âœ… **ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§**: API í˜¸ì¶œ ìˆ˜, ì‚¬ìš©ì í™œë™, íŠ¸ë˜í”½ íŒ¨í„´
- âœ… **ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§**: ì„œë²„ ìƒíƒœ, ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

## ğŸ“ˆ 1ë‹¨ê³„: ì‹¤ì‹œê°„ ë¡œê·¸ ëª¨ë‹ˆí„°ë§

### 1.1 ê¸°ë³¸ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
tail -f api_logs.txt

# ì—ëŸ¬ë§Œ í•„í„°ë§
tail -f api_logs.txt | grep "ERROR"

# íŠ¹ì • ì‹œê°„ëŒ€ ë¡œê·¸ í™•ì¸
grep "2024-01-15" api_logs.txt

# ìš”ì²­ ì œí•œ ê´€ë ¨ ë¡œê·¸
grep "Rate limit" api_logs.txt
```

### 1.2 ë¡œê·¸ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸
```php
<?php
// log_analyzer.php - ë¡œê·¸ ë¶„ì„ ë„êµ¬

class LogAnalyzer {
    private $logFile;
    
    public function __construct($logFile = 'api_logs.txt') {
        $this->logFile = $logFile;
    }
    
    public function getTodayStats() {
        $today = date('Y-m-d');
        $lines = file($this->logFile, FILE_IGNORE_NEW_LINES);
        
        $stats = [
            'total_requests' => 0,
            'successful_requests' => 0,
            'failed_requests' => 0,
            'rate_limit_exceeded' => 0,
            'avg_response_time' => 0
        ];
        
        $responseTimes = [];
        
        foreach ($lines as $line) {
            if (strpos($line, $today) === 0) {
                $stats['total_requests']++;
                
                if (strpos($line, 'ERROR') !== false) {
                    $stats['failed_requests']++;
                    
                    if (strpos($line, 'Rate limit') !== false) {
                        $stats['rate_limit_exceeded']++;
                    }
                } else {
                    $stats['successful_requests']++;
                }
                
                // ì‘ë‹µ ì‹œê°„ ì¶”ì¶œ
                if (preg_match('/API call successful: ([\d.]+)s/', $line, $matches)) {
                    $responseTimes[] = floatval($matches[1]);
                }
            }
        }
        
        if (!empty($responseTimes)) {
            $stats['avg_response_time'] = array_sum($responseTimes) / count($responseTimes);
        }
        
        return $stats;
    }
    
    public function getTopIPs($limit = 10) {
        $today = date('Y-m-d');
        $lines = file($this->logFile, FILE_IGNORE_NEW_LINES);
        
        $ipCounts = [];
        
        foreach ($lines as $line) {
            if (strpos($line, $today) === 0 && preg_match('/\[(\d+\.\d+\.\d+\.\d+)\]/', $line, $matches)) {
                $ip = $matches[1];
                $ipCounts[$ip] = ($ipCounts[$ip] ?? 0) + 1;
            }
        }
        
        arsort($ipCounts);
        return array_slice($ipCounts, 0, $limit, true);
    }
    
    public function getErrorPatterns() {
        $today = date('Y-m-d');
        $lines = file($this->logFile, FILE_IGNORE_NEW_LINES);
        
        $errorPatterns = [];
        
        foreach ($lines as $line) {
            if (strpos($line, $today) === 0 && strpos($line, 'ERROR') !== false) {
                if (preg_match('/ERROR\] (.*)/', $line, $matches)) {
                    $error = $matches[1];
                    $errorPatterns[$error] = ($errorPatterns[$error] ?? 0) + 1;
                }
            }
        }
        
        arsort($errorPatterns);
        return $errorPatterns;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
$analyzer = new LogAnalyzer();
$todayStats = $analyzer->getTodayStats();
$topIPs = $analyzer->getTopIPs();
$errorPatterns = $analyzer->getErrorPatterns();

echo "=== ì˜¤ëŠ˜ í†µê³„ ===\n";
echo "ì´ ìš”ì²­ ìˆ˜: {$todayStats['total_requests']}\n";
echo "ì„±ê³µ ìš”ì²­: {$todayStats['successful_requests']}\n";
echo "ì‹¤íŒ¨ ìš”ì²­: {$todayStats['failed_requests']}\n";
echo "í‰ê·  ì‘ë‹µ ì‹œê°„: {$todayStats['avg_response_time']}ì´ˆ\n";
echo "ìš”ì²­ ì œí•œ ì´ˆê³¼: {$todayStats['rate_limit_exceeded']}\n";
?>
```

### 1.3 ë¡œê·¸ ëŒ€ì‹œë³´ë“œ
```php
<?php
// dashboard.php - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

class MonitoringDashboard {
    private $logAnalyzer;
    
    public function __construct() {
        $this->logAnalyzer = new LogAnalyzer();
    }
    
    public function generateDashboard() {
        $stats = $this->logAnalyzer->getTodayStats();
        $topIPs = $this->logAnalyzer->getTopIPs();
        $errorPatterns = $this->logAnalyzer->getErrorPatterns();
        
        $html = $this->generateHTML($stats, $topIPs, $errorPatterns);
        
        file_put_contents('dashboard.html', $html);
        
        return $html;
    }
    
    private function generateHTML($stats, $topIPs, $errorPatterns) {
        $successRate = $stats['total_requests'] > 0 ? 
            round(($stats['successful_requests'] / $stats['total_requests']) * 100, 2) : 0;
            
        return "
        <!DOCTYPE html>
        <html>
        <head>
            <title>API ì„œë²„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
            <meta http-equiv='refresh' content='30'>
            <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
                .stat-card { background: #f5f5f5; padding: 20px; border-radius: 8px; text-align: center; }
                .stat-value { font-size: 2em; font-weight: bold; color: #333; }
                .stat-label { color: #666; margin-top: 10px; }
                .success { color: #28a745; }
                .error { color: #dc3545; }
                .warning { color: #ffc107; }
                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
                th { background-color: #f2f2f2; }
            </style>
        </head>
        <body>
            <h1>ğŸš€ API ì„œë²„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h1>
            <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: " . date('Y-m-d H:i:s') . "</p>
            
            <div class='stats'>
                <div class='stat-card'>
                    <div class='stat-value'>{$stats['total_requests']}</div>
                    <div class='stat-label'>ì´ ìš”ì²­ ìˆ˜</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value success'>{$stats['successful_requests']}</div>
                    <div class='stat-label'>ì„±ê³µ ìš”ì²­</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value error'>{$stats['failed_requests']}</div>
                    <div class='stat-label'>ì‹¤íŒ¨ ìš”ì²­</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value'>{$successRate}%</div>
                    <div class='stat-label'>ì„±ê³µë¥ </div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value'>{$stats['avg_response_time']}ì´ˆ</div>
                    <div class='stat-label'>í‰ê·  ì‘ë‹µ ì‹œê°„</div>
                </div>
                <div class='stat-card'>
                    <div class='stat-value warning'>{$stats['rate_limit_exceeded']}</div>
                    <div class='stat-label'>ìš”ì²­ ì œí•œ ì´ˆê³¼</div>
                </div>
            </div>
            
            <h2>ğŸ“Š ìƒìœ„ IP ì£¼ì†Œ</h2>
            <table>
                <tr><th>IP ì£¼ì†Œ</th><th>ìš”ì²­ ìˆ˜</th></tr>
        " . $this->generateTopIPsTable($topIPs) . "
            </table>
            
            <h2>âš ï¸ ì—ëŸ¬ íŒ¨í„´</h2>
            <table>
                <tr><th>ì—ëŸ¬ ë©”ì‹œì§€</th><th>ë°œìƒ íšŸìˆ˜</th></tr>
        " . $this->generateErrorPatternsTable($errorPatterns) . "
            </table>
        </body>
        </html>";
    }
    
    private function generateTopIPsTable($topIPs) {
        $html = '';
        foreach ($topIPs as $ip => $count) {
            $html .= "<tr><td>$ip</td><td>$count</td></tr>";
        }
        return $html;
    }
    
    private function generateErrorPatternsTable($errorPatterns) {
        $html = '';
        foreach ($errorPatterns as $error => $count) {
            $html .= "<tr><td>$error</td><td>$count</td></tr>";
        }
        return $html;
    }
}

// ëŒ€ì‹œë³´ë“œ ìƒì„±
$dashboard = new MonitoringDashboard();
$dashboard->generateDashboard();
echo "ëŒ€ì‹œë³´ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: dashboard.html";
?>
```

## ğŸ“Š 2ë‹¨ê³„: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### 2.1 ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
```php
class PerformanceMonitor {
    private $metrics = [];
    
    public function startTimer($operation) {
        $this->metrics[$operation] = [
            'start_time' => microtime(true),
            'memory_start' => memory_get_usage()
        ];
    }
    
    public function endTimer($operation) {
        if (!isset($this->metrics[$operation])) {
            return null;
        }
        
        $start = $this->metrics[$operation];
        $endTime = microtime(true);
        $endMemory = memory_get_usage();
        
        $result = [
            'operation' => $operation,
            'execution_time' => $endTime - $start['start_time'],
            'memory_usage' => $endMemory - $start['memory_start'],
            'peak_memory' => memory_get_peak_usage(),
            'timestamp' => date('Y-m-d H:i:s')
        ];
        
        $this->saveMetrics($result);
        
        return $result;
    }
    
    private function saveMetrics($metrics) {
        $logLine = json_encode($metrics) . "\n";
        file_put_contents('performance_logs.txt', $logLine, FILE_APPEND | LOCK_EX);
    }
    
    public function getPerformanceStats($hours = 24) {
        $lines = file('performance_logs.txt', FILE_IGNORE_NEW_LINES);
        $cutoff = time() - ($hours * 3600);
        
        $stats = [];
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strtotime($data['timestamp']) > $cutoff) {
                $operation = $data['operation'];
                
                if (!isset($stats[$operation])) {
                    $stats[$operation] = [
                        'count' => 0,
                        'total_time' => 0,
                        'total_memory' => 0,
                        'max_time' => 0,
                        'max_memory' => 0
                    ];
                }
                
                $stats[$operation]['count']++;
                $stats[$operation]['total_time'] += $data['execution_time'];
                $stats[$operation]['total_memory'] += $data['memory_usage'];
                $stats[$operation]['max_time'] = max($stats[$operation]['max_time'], $data['execution_time']);
                $stats[$operation]['max_memory'] = max($stats[$operation]['max_memory'], $data['memory_usage']);
            }
        }
        
        // í‰ê·  ê³„ì‚°
        foreach ($stats as $operation => &$stat) {
            if ($stat['count'] > 0) {
                $stat['avg_time'] = $stat['total_time'] / $stat['count'];
                $stat['avg_memory'] = $stat['total_memory'] / $stat['count'];
            }
        }
        
        return $stats;
    }
}

// ì‚¬ìš© ì˜ˆì‹œ
$monitor = new PerformanceMonitor();

// API í˜¸ì¶œ ì‹œê°„ ì¸¡ì •
$monitor->startTimer('openai_api_call');
// ... API í˜¸ì¶œ ì½”ë“œ ...
$result = $monitor->endTimer('openai_api_call');

echo "API í˜¸ì¶œ ì‹œê°„: {$result['execution_time']}ì´ˆ\n";
echo "ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: {$result['memory_usage']}ë°”ì´íŠ¸\n";
```

### 2.2 ìë™ ì„±ëŠ¥ ì•Œë¦¼
```php
class PerformanceAlert {
    private $thresholds = [
        'response_time' => 10.0, // 10ì´ˆ
        'memory_usage' => 128 * 1024 * 1024, // 128MB
        'error_rate' => 0.05 // 5%
    ];
    
    public function checkPerformance($stats) {
        $alerts = [];
        
        foreach ($stats as $operation => $stat) {
            // ì‘ë‹µ ì‹œê°„ ì²´í¬
            if ($stat['avg_time'] > $this->thresholds['response_time']) {
                $alerts[] = [
                    'type' => 'slow_response',
                    'operation' => $operation,
                    'value' => $stat['avg_time'],
                    'threshold' => $this->thresholds['response_time']
                ];
            }
            
            // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬
            if ($stat['avg_memory'] > $this->thresholds['memory_usage']) {
                $alerts[] = [
                    'type' => 'high_memory',
                    'operation' => $operation,
                    'value' => $stat['avg_memory'],
                    'threshold' => $this->thresholds['memory_usage']
                ];
            }
        }
        
        if (!empty($alerts)) {
            $this->sendPerformanceAlert($alerts);
        }
        
        return $alerts;
    }
    
    private function sendPerformanceAlert($alerts) {
        $message = "ì„±ëŠ¥ ì„ê³„ê°’ ì´ˆê³¼ ì•Œë¦¼:\n\n";
        
        foreach ($alerts as $alert) {
            $message .= "- {$alert['operation']}: {$alert['value']} > {$alert['threshold']}\n";
        }
        
        mail('admin@edgeenglish.net', 'ì„±ëŠ¥ ì•Œë¦¼', $message);
    }
}
```

## ğŸ”’ 3ë‹¨ê³„: ë³´ì•ˆ ëª¨ë‹ˆí„°ë§

### 3.1 ë³´ì•ˆ ì´ë²¤íŠ¸ ê°ì§€
```php
class SecurityMonitor {
    private $securityLogFile = 'security_logs.txt';
    private $suspiciousPatterns = [
        'sql_injection' => ['UNION', 'SELECT', 'DROP', 'INSERT', 'DELETE'],
        'xss_attempt' => ['<script', 'javascript:', 'onload='],
        'path_traversal' => ['../', '..\\', '/etc/passwd', 'windows/system32'],
        'command_injection' => [';', '|', '&', '`', '$(']
    ];
    
    public function analyzeRequest($request) {
        $riskScore = 0;
        $detectedThreats = [];
        
        $requestString = json_encode($request);
        
        foreach ($this->suspiciousPatterns as $threat => $patterns) {
            foreach ($patterns as $pattern) {
                if (stripos($requestString, $pattern) !== false) {
                    $riskScore += 10;
                    $detectedThreats[] = $threat;
                }
            }
        }
        
        if ($riskScore > 0) {
            $this->logSecurityEvent('suspicious_request', [
                'risk_score' => $riskScore,
                'threats' => $detectedThreats,
                'request' => $request,
                'ip' => $_SERVER['REMOTE_ADDR'] ?? 'unknown'
            ]);
        }
        
        return ['risk_score' => $riskScore, 'threats' => $detectedThreats];
    }
    
    private function logSecurityEvent($event, $details) {
        $logEntry = [
            'timestamp' => date('Y-m-d H:i:s'),
            'event' => $event,
            'details' => $details
        ];
        
        $logLine = json_encode($logEntry) . "\n";
        file_put_contents($this->securityLogFile, $logLine, FILE_APPEND | LOCK_EX);
        
        // ë†’ì€ ìœ„í—˜ë„ëŠ” ì¦‰ì‹œ ì•Œë¦¼
        if ($details['risk_score'] > 50) {
            $this->sendSecurityAlert($event, $details);
        }
    }
    
    private function sendSecurityAlert($event, $details) {
        $message = "ë³´ì•ˆ ê²½ê³ : $event\n";
        $message .= "ìœ„í—˜ ì ìˆ˜: {$details['risk_score']}\n";
        $message .= "ê°ì§€ëœ ìœ„í˜‘: " . implode(', ', $details['threats']) . "\n";
        $message .= "IP ì£¼ì†Œ: {$details['ip']}\n";
        
        mail('security@edgeenglish.net', 'ë³´ì•ˆ ê²½ê³ ', $message);
    }
    
    public function getSecurityStats($days = 7) {
        $lines = file($this->securityLogFile, FILE_IGNORE_NEW_LINES);
        $cutoff = time() - ($days * 24 * 3600);
        
        $stats = [
            'total_events' => 0,
            'high_risk_events' => 0,
            'threat_types' => [],
            'top_ips' => []
        ];
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strtotime($data['timestamp']) > $cutoff) {
                $stats['total_events']++;
                
                $riskScore = $data['details']['risk_score'] ?? 0;
                if ($riskScore > 50) {
                    $stats['high_risk_events']++;
                }
                
                // ìœ„í˜‘ ìœ í˜•ë³„ ì¹´ìš´íŠ¸
                if (isset($data['details']['threats'])) {
                    foreach ($data['details']['threats'] as $threat) {
                        $stats['threat_types'][$threat] = ($stats['threat_types'][$threat] ?? 0) + 1;
                    }
                }
                
                // IPë³„ ì¹´ìš´íŠ¸
                $ip = $data['details']['ip'] ?? 'unknown';
                $stats['top_ips'][$ip] = ($stats['top_ips'][$ip] ?? 0) + 1;
            }
        }
        
        arsort($stats['threat_types']);
        arsort($stats['top_ips']);
        
        return $stats;
    }
}
```

### 3.2 ì‹¤ì‹œê°„ ë³´ì•ˆ ëŒ€ì‹œë³´ë“œ
```php
<?php
// security_dashboard.php - ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

$securityMonitor = new SecurityMonitor();
$stats = $securityMonitor->getSecurityStats();

$html = "
<!DOCTYPE html>
<html>
<head>
    <title>ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</title>
    <meta http-equiv='refresh' content='60'>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .alert { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .stat-card { background: #f5f5f5; padding: 20px; border-radius: 8px; }
        .threat-level-high { color: #dc3545; font-weight: bold; }
        .threat-level-medium { color: #ffc107; font-weight: bold; }
        .threat-level-low { color: #28a745; }
    </style>
</head>
<body>
    <h1>ğŸ”’ ë³´ì•ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ</h1>
    <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: " . date('Y-m-d H:i:s') . "</p>
    
    <div class='stats'>
        <div class='stat-card'>
            <h3>ì´ ë³´ì•ˆ ì´ë²¤íŠ¸</h3>
            <div style='font-size: 2em; font-weight: bold;'>{$stats['total_events']}</div>
        </div>
        <div class='stat-card'>
            <h3>ê³ ìœ„í—˜ ì´ë²¤íŠ¸</h3>
            <div style='font-size: 2em; font-weight: bold; color: #dc3545;'>{$stats['high_risk_events']}</div>
        </div>
    </div>
    
    <h2>âš ï¸ ê°ì§€ëœ ìœ„í˜‘ ìœ í˜•</h2>
    <ul>
";

foreach ($stats['threat_types'] as $threat => $count) {
    $level = $count > 10 ? 'high' : ($count > 5 ? 'medium' : 'low');
    $html .= "<li class='threat-level-$level'>$threat: $countíšŒ</li>";
}

$html .= "
    </ul>
    
    <h2>ğŸŒ ìƒìœ„ ì˜ì‹¬ IP ì£¼ì†Œ</h2>
    <ul>
";

foreach (array_slice($stats['top_ips'], 0, 10, true) as $ip => $count) {
    $html .= "<li>$ip: $countíšŒ</li>";
}

$html .= "
    </ul>
</body>
</html>";

file_put_contents('security_dashboard.html', $html);
echo "ë³´ì•ˆ ëŒ€ì‹œë³´ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: security_dashboard.html";
?>
```

## ğŸ“Š 4ë‹¨ê³„: ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

### 4.1 API ì‚¬ìš©ëŸ‰ ì¶”ì 
```php
class UsageTracker {
    private $usageFile = 'usage_logs.txt';
    
    public function trackUsage($clientId, $endpoint, $tokens = 0, $cost = 0) {
        $usage = [
            'timestamp' => date('Y-m-d H:i:s'),
            'client_id' => $clientId,
            'endpoint' => $endpoint,
            'tokens' => $tokens,
            'cost' => $cost,
            'ip' => $_SERVER['REMOTE_ADDR'] ?? 'unknown'
        ];
        
        $logLine = json_encode($usage) . "\n";
        file_put_contents($this->usageFile, $logLine, FILE_APPEND | LOCK_EX);
    }
    
    public function getUsageStats($period = 'daily') {
        $lines = file($this->usageFile, FILE_IGNORE_NEW_LINES);
        
        $stats = [
            'total_requests' => 0,
            'total_tokens' => 0,
            'total_cost' => 0,
            'by_endpoint' => [],
            'by_client' => [],
            'by_hour' => []
        ];
        
        $cutoff = $this->getCutoffTime($period);
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strtotime($data['timestamp']) > $cutoff) {
                $stats['total_requests']++;
                $stats['total_tokens'] += $data['tokens'];
                $stats['total_cost'] += $data['cost'];
                
                // ì—”ë“œí¬ì¸íŠ¸ë³„ í†µê³„
                $endpoint = $data['endpoint'];
                if (!isset($stats['by_endpoint'][$endpoint])) {
                    $stats['by_endpoint'][$endpoint] = [
                        'requests' => 0,
                        'tokens' => 0,
                        'cost' => 0
                    ];
                }
                $stats['by_endpoint'][$endpoint]['requests']++;
                $stats['by_endpoint'][$endpoint]['tokens'] += $data['tokens'];
                $stats['by_endpoint'][$endpoint]['cost'] += $data['cost'];
                
                // ì‹œê°„ëŒ€ë³„ í†µê³„
                $hour = date('H', strtotime($data['timestamp']));
                $stats['by_hour'][$hour] = ($stats['by_hour'][$hour] ?? 0) + 1;
            }
        }
        
        return $stats;
    }
    
    private function getCutoffTime($period) {
        switch ($period) {
            case 'hourly':
                return time() - 3600;
            case 'daily':
                return time() - (24 * 3600);
            case 'weekly':
                return time() - (7 * 24 * 3600);
            case 'monthly':
                return time() - (30 * 24 * 3600);
            default:
                return time() - (24 * 3600);
        }
    }
    
    public function generateUsageReport($period = 'daily') {
        $stats = $this->getUsageStats($period);
        
        $report = "
        === API ì‚¬ìš©ëŸ‰ ë³´ê³ ì„œ ($period) ===
        ì´ ìš”ì²­ ìˆ˜: {$stats['total_requests']}
        ì´ í† í° ìˆ˜: {$stats['total_tokens']}
        ì´ ë¹„ìš©: \${$stats['total_cost']}
        
        ì—”ë“œí¬ì¸íŠ¸ë³„ ì‚¬ìš©ëŸ‰:
        ";
        
        foreach ($stats['by_endpoint'] as $endpoint => $data) {
            $report .= "- $endpoint: {$data['requests']}íšŒ, {$data['tokens']}í† í°, \${$data['cost']}\n";
        }
        
        $report .= "\nì‹œê°„ëŒ€ë³„ ì‚¬ìš©ëŸ‰:\n";
        ksort($stats['by_hour']);
        foreach ($stats['by_hour'] as $hour => $count) {
            $report .= "- {$hour}:00 - {$count}íšŒ\n";
        }
        
        return $report;
    }
}
```

### 4.2 ë¹„ìš© ëª¨ë‹ˆí„°ë§
```php
class CostMonitor {
    private $costRates = [
        'gpt-4o' => [
            'input' => 0.005, // $0.005 per 1K tokens
            'output' => 0.015  // $0.015 per 1K tokens
        ],
        'gpt-4' => [
            'input' => 0.03,
            'output' => 0.06
        ],
        'gpt-3.5-turbo' => [
            'input' => 0.001,
            'output' => 0.002
        ]
    ];
    
    public function calculateCost($model, $inputTokens, $outputTokens) {
        if (!isset($this->costRates[$model])) {
            return 0;
        }
        
        $rates = $this->costRates[$model];
        $inputCost = ($inputTokens / 1000) * $rates['input'];
        $outputCost = ($outputTokens / 1000) * $rates['output'];
        
        return $inputCost + $outputCost;
    }
    
    public function getDailyCost($date = null) {
        if (!$date) {
            $date = date('Y-m-d');
        }
        
        $lines = file('usage_logs.txt', FILE_IGNORE_NEW_LINES);
        $totalCost = 0;
        
        foreach ($lines as $line) {
            $data = json_decode($line, true);
            if ($data && strpos($data['timestamp'], $date) === 0) {
                $totalCost += $data['cost'];
            }
        }
        
        return $totalCost;
    }
    
    public function getMonthlyProjection() {
        $today = date('Y-m-d');
        $daysInMonth = date('t');
        $currentDay = date('j');
        
        $currentCost = $this->getDailyCost();
        $projectedCost = ($currentCost / $currentDay) * $daysInMonth;
        
        return [
            'current_cost' => $currentCost,
            'projected_cost' => $projectedCost,
            'days_remaining' => $daysInMonth - $currentDay
        ];
    }
}
```

## ğŸ”” 5ë‹¨ê³„: ìë™ ì•Œë¦¼ ì‹œìŠ¤í…œ

### 5.1 ì•Œë¦¼ ì„¤ì •
```php
class NotificationSystem {
    private $alerts = [];
    
    public function __construct() {
        $this->loadAlertConfig();
    }
    
    private function loadAlertConfig() {
        $this->alerts = [
            'high_error_rate' => [
                'threshold' => 0.05, // 5%
                'enabled' => true,
                'recipients' => ['admin@edgeenglish.net']
            ],
            'slow_response' => [
                'threshold' => 10.0, // 10ì´ˆ
                'enabled' => true,
                'recipients' => ['admin@edgeenglish.net']
            ],
            'high_cost' => [
                'threshold' => 100.0, // $100
                'enabled' => true,
                'recipients' => ['admin@edgeenglish.net', 'finance@edgeenglish.net']
            ],
            'security_threat' => [
                'threshold' => 50, // ìœ„í—˜ ì ìˆ˜
                'enabled' => true,
                'recipients' => ['security@edgeenglish.net']
            ]
        ];
    }
    
    public function checkAlerts($metrics) {
        $triggeredAlerts = [];
        
        // ì—ëŸ¬ìœ¨ ì²´í¬
        if (isset($metrics['error_rate']) && 
            $metrics['error_rate'] > $this->alerts['high_error_rate']['threshold']) {
            $triggeredAlerts[] = [
                'type' => 'high_error_rate',
                'value' => $metrics['error_rate'],
                'threshold' => $this->alerts['high_error_rate']['threshold']
            ];
        }
        
        // ì‘ë‹µ ì‹œê°„ ì²´í¬
        if (isset($metrics['avg_response_time']) && 
            $metrics['avg_response_time'] > $this->alerts['slow_response']['threshold']) {
            $triggeredAlerts[] = [
                'type' => 'slow_response',
                'value' => $metrics['avg_response_time'],
                'threshold' => $this->alerts['slow_response']['threshold']
            ];
        }
        
        // ë¹„ìš© ì²´í¬
        if (isset($metrics['daily_cost']) && 
            $metrics['daily_cost'] > $this->alerts['high_cost']['threshold']) {
            $triggeredAlerts[] = [
                'type' => 'high_cost',
                'value' => $metrics['daily_cost'],
                'threshold' => $this->alerts['high_cost']['threshold']
            ];
        }
        
        foreach ($triggeredAlerts as $alert) {
            $this->sendAlert($alert);
        }
        
        return $triggeredAlerts;
    }
    
    private function sendAlert($alert) {
        $config = $this->alerts[$alert['type']];
        
        if (!$config['enabled']) {
            return;
        }
        
        $subject = $this->getAlertSubject($alert['type']);
        $message = $this->getAlertMessage($alert);
        
        foreach ($config['recipients'] as $recipient) {
            mail($recipient, $subject, $message);
        }
        
        // Slack ì•Œë¦¼ (ì„ íƒì‚¬í•­)
        $this->sendSlackAlert($alert);
    }
    
    private function getAlertSubject($type) {
        $subjects = [
            'high_error_rate' => '[ê²½ê³ ] ë†’ì€ ì—ëŸ¬ìœ¨ ê°ì§€',
            'slow_response' => '[ê²½ê³ ] ëŠë¦° ì‘ë‹µ ì‹œê°„ ê°ì§€',
            'high_cost' => '[ê²½ê³ ] ë†’ì€ API ë¹„ìš© ê°ì§€',
            'security_threat' => '[ë³´ì•ˆ] ë³´ì•ˆ ìœ„í˜‘ ê°ì§€'
        ];
        
        return $subjects[$type] ?? '[ì•Œë¦¼] ì‹œìŠ¤í…œ ì•Œë¦¼';
    }
    
    private function getAlertMessage($alert) {
        $message = "ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ì•Œë¦¼\n\n";
        $message .= "ì•Œë¦¼ ìœ í˜•: {$alert['type']}\n";
        $message .= "í˜„ì¬ ê°’: {$alert['value']}\n";
        $message .= "ì„ê³„ê°’: {$alert['threshold']}\n";
        $message .= "ë°œìƒ ì‹œê°„: " . date('Y-m-d H:i:s') . "\n";
        $message .= "\nê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.";
        
        return $message;
    }
    
    private function sendSlackAlert($alert) {
        $webhookUrl = 'YOUR_SLACK_WEBHOOK_URL';
        
        $payload = [
            'text' => "ğŸš¨ ì‹œìŠ¤í…œ ì•Œë¦¼",
            'attachments' => [
                [
                    'color' => 'danger',
                    'fields' => [
                        [
                            'title' => 'ì•Œë¦¼ ìœ í˜•',
                            'value' => $alert['type'],
                            'short' => true
                        ],
                        [
                            'title' => 'í˜„ì¬ ê°’',
                            'value' => $alert['value'],
                            'short' => true
                        ],
                        [
                            'title' => 'ì„ê³„ê°’',
                            'value' => $alert['threshold'],
                            'short' => true
                        ]
                    ]
                ]
            ]
        ];
        
        $ch = curl_init($webhookUrl);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($payload));
        curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_exec($ch);
        curl_close($ch);
    }
}
```

## ğŸ“‹ ëª¨ë‹ˆí„°ë§ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì¼ì¼ ëª¨ë‹ˆí„°ë§
- [ ] API ì‘ë‹µ ì‹œê°„ í™•ì¸ (ëª©í‘œ: 5ì´ˆ ì´ë‚´)
- [ ] ì—ëŸ¬ìœ¨ í™•ì¸ (ëª©í‘œ: 1% ì´í•˜)
- [ ] ìš”ì²­ ì œí•œ ì´ˆê³¼ í™•ì¸
- [ ] ë³´ì•ˆ ì´ë²¤íŠ¸ í™•ì¸
- [ ] ì„œë²„ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸

### ì£¼ê°„ ëª¨ë‹ˆí„°ë§
- [ ] ì„±ëŠ¥ íŠ¸ë Œë“œ ë¶„ì„
- [ ] ì‚¬ìš©ëŸ‰ íŒ¨í„´ ë¶„ì„
- [ ] ë¹„ìš© ë¶„ì„ ë° ì˜ˆì¸¡
- [ ] ë³´ì•ˆ ìœ„í˜‘ ë¶„ì„
- [ ] ë¡œê·¸ íŒŒì¼ ì •ë¦¬

### ì›”ê°„ ëª¨ë‹ˆí„°ë§
- [ ] ì „ì²´ ì„±ëŠ¥ ë³´ê³ ì„œ ì‘ì„±
- [ ] ë¹„ìš© ìµœì í™” ë°©ì•ˆ ê²€í† 
- [ ] ë³´ì•ˆ ì •ì±… ì—…ë°ì´íŠ¸
- [ ] ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ê°œì„ 
- [ ] ë°±ì—… ë° ë³µêµ¬ ê³„íš ê²€í† 

---

## ğŸ¯ ëª¨ë‹ˆí„°ë§ ì„±ê³µ ì§€í‘œ

### ëª©í‘œ ë‹¬ì„±ë¥ 
- **ê°€ìš©ì„±**: 99.9% ì´ìƒ ë‹¬ì„±
- **ì‘ë‹µ ì‹œê°„**: í‰ê·  5ì´ˆ ì´ë‚´ ìœ ì§€
- **ì„±ê³µë¥ **: 99% ì´ìƒ ìœ ì§€
- **ë³´ì•ˆ ì‚¬ê³ **: 0ê±´ ìœ ì§€
- **ë¹„ìš© íš¨ìœ¨ì„±**: ì˜ˆì‚° ë‚´ ìš´ì˜

### ê°œì„  ì§€í‘œ
- **ë¬¸ì œ í•´ê²° ì‹œê°„**: 5ë¶„ ì´ë‚´
- **ì•Œë¦¼ ì •í™•ë„**: 95% ì´ìƒ
- **ëª¨ë‹ˆí„°ë§ ì»¤ë²„ë¦¬ì§€**: 100%
- **ìë™í™”ìœ¨**: 90% ì´ìƒ

**ì´ ê°€ì´ë“œë¥¼ ë”°ë¼í•˜ë©´ dothome.co.kr ë°±ì—”ë“œ ì„œë²„ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!** ğŸ“Š
