# 🚀 edgeenglish.net 배포 가이드

## 📋 개요

이 문서는 **dothome.co.kr 호스팅 환경**에 React 애플리케이션과 PHP 백엔드 API 프록시 서버를 배포하기 위한 완전한 가이드입니다.

## 🎯 배포 환경

- **배포 대상**: https://edgeenglish.net
- **호스팅 방식**: dothome.co.kr (Apache + PHP)
- **아키텍처**: React SPA + PHP API 프록시 서버
- **보안**: API Key 서버 측 보호, 클라이언트 노출 방지
- **콘솔 로그**: 프로덕션 환경에서 자동 비활성화

## 🏗️ 시스템 아키텍처

### 전체 구조
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   React SPA     │    │  PHP API Proxy   │    │  OpenAI API     │
│ (Frontend)      │───▶│   (Backend)      │───▶│   (External)    │
│                 │    │                  │    │                 │
│ - UI Components │    │ - secure-api-    │    │ - GPT-4         │
│ - State Mgmt    │    │   proxy.php      │    │ - Vision API    │
│ - API Calls     │    │ - Rate Limiting  │    │ - Embeddings    │
└─────────────────┘    └──────────────────┘    └─────────────────┘
        │                        │
        │                        │
        ▼                        ▼
┌─────────────────┐    ┌──────────────────┐
│   Firebase      │    │ dothome.co.kr    │
│   (Database)    │    │   (Hosting)      │
└─────────────────┘    └──────────────────┘
```

## 🔧 빌드 전 준비사항

### 1. 환경 변수 설정

#### 클라이언트 측 환경 변수 (React 앱)

```bash
# Firebase 설정 (클라이언트에서 사용)
REACT_APP_FIREBASE_API_KEY=AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo
REACT_APP_FIREBASE_AUTH_DOMAIN=edgeenglishlab.firebaseapp.com
REACT_APP_FIREBASE_PROJECT_ID=edgeenglishlab
REACT_APP_FIREBASE_STORAGE_BUCKET=edgeenglishlab.firebasestorage.app
REACT_APP_FIREBASE_MESSAGING_SENDER_ID=13831715924
REACT_APP_FIREBASE_APP_ID=1:13831715924:web:41907bce49707865e981c1

# API 프록시 서버 URL (중요!)
REACT_APP_API_PROXY_URL=https://edgeenglish.net/secure-api-proxy.php

# ⚠️ OpenAI API Key는 클라이언트에 설정하지 않음 (보안상 서버에서만 사용)
```

#### 서버 측 환경 변수 (dothome.co.kr 관리자 패널에서 설정)

```bash
# OpenAI API Key (서버에서만 사용)
OPENAI_API_KEY=YOUR_OPENAI_API_KEY_HERE

# API 설정
API_RATE_LIMIT=300
API_TIMEOUT=60
```

#### 환경 변수 설정 방법

**방법 1: PowerShell에서 직접 설정 (권장)**
```powershell
# 클라이언트 환경 변수 설정
$env:REACT_APP_FIREBASE_API_KEY="AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo"
$env:REACT_APP_FIREBASE_AUTH_DOMAIN="edgeenglishlab.firebaseapp.com"
$env:REACT_APP_FIREBASE_PROJECT_ID="edgeenglishlab"
$env:REACT_APP_FIREBASE_STORAGE_BUCKET="edgeenglishlab.firebasestorage.app"
$env:REACT_APP_FIREBASE_MESSAGING_SENDER_ID="13831715924"
$env:REACT_APP_FIREBASE_APP_ID="1:13831715924:web:41907bce49707865e981c1"
$env:REACT_APP_API_PROXY_URL="https://edgeenglish.net/secure-api-proxy.php"

# 빌드 실행
npm run build
```

**방법 2: .env.local 파일 생성**
```bash
# .env.local 파일 생성
echo "REACT_APP_FIREBASE_API_KEY=AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo" > .env.local
echo "REACT_APP_FIREBASE_AUTH_DOMAIN=edgeenglishlab.firebaseapp.com" >> .env.local
echo "REACT_APP_FIREBASE_PROJECT_ID=edgeenglishlab" >> .env.local
echo "REACT_APP_FIREBASE_STORAGE_BUCKET=edgeenglishlab.firebasestorage.app" >> .env.local
echo "REACT_APP_FIREBASE_MESSAGING_SENDER_ID=13831715924" >> .env.local
echo "REACT_APP_FIREBASE_APP_ID=1:13831715924:web:41907bce49707865e981c1" >> .env.local
echo "REACT_APP_API_PROXY_URL=https://edgeenglish.net/secure-api-proxy.php" >> .env.local

# 빌드 실행
npm run build
```

### 2. 콘솔 로그 비활성화 설정

프로덕션 환경에서 콘솔 로그를 자동으로 비활성화하는 설정이 포함되어 있습니다.

#### 자동 콘솔 로그 비활성화

`src/utils/disableConsole.js` 파일이 자동으로 생성되어 프로덕션 환경에서 모든 콘솔 메서드를 비활성화합니다:

```javascript
// 프로덕션 환경에서 콘솔 로그 비활성화
if (process.env.NODE_ENV === 'production') {
  console.log = () => {};
  console.warn = () => {};
  console.error = () => {};
  console.info = () => {};
  console.debug = () => {};
  // ... 기타 모든 콘솔 메서드들
}
```

#### App.tsx에 자동 로드

`src/App.tsx`에서 자동으로 로드되어 프로덕션 빌드 시 콘솔 로그가 비활성화됩니다:

```javascript
// 프로덕션 환경에서 콘솔 로그 비활성화
import './utils/disableConsole';
```

### 3. 기존 빌드 정리

```powershell
# 기존 빌드 폴더 삭제
if (Test-Path build) { Remove-Item -Recurse -Force build }
if (Test-Path deployment_package) { Remove-Item -Recurse -Force deployment_package }

# 또는 Windows 명령어
rmdir /s /q build
rmdir /s /q deployment_package
```

## 🚀 단계별 배포 절차

### 전체 자동화 스크립트 (권장)

```powershell
# 🚀 edgeenglish.net 전체 배포 자동화 스크립트
Write-Host "🚀 edgeenglish.net 배포 시작..." -ForegroundColor Green

# 1단계: 환경 변수 설정
Write-Host "`n📝 1단계: 환경 변수 설정..." -ForegroundColor Cyan
$env:REACT_APP_API_PROXY_URL="https://edgeenglish.net/secure-api-proxy.php"
$env:REACT_APP_FIREBASE_API_KEY="AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo"
$env:REACT_APP_FIREBASE_AUTH_DOMAIN="edgeenglishlab.firebaseapp.com"
$env:REACT_APP_FIREBASE_PROJECT_ID="edgeenglishlab"
$env:REACT_APP_FIREBASE_STORAGE_BUCKET="edgeenglishlab.firebasestorage.app"
$env:REACT_APP_FIREBASE_MESSAGING_SENDER_ID="13831715924"
$env:REACT_APP_FIREBASE_APP_ID="1:13831715924:web:41907bce49707865e981c1"
Write-Host "✅ 환경 변수 설정 완료" -ForegroundColor Green

# 2단계: 기존 빌드 정리
Write-Host "`n🧹 2단계: 기존 빌드 정리..." -ForegroundColor Cyan
if (Test-Path "build") { 
    Remove-Item -Recurse -Force "build" 
    Write-Host "✅ 기존 build 폴더 삭제 완료" -ForegroundColor Yellow
}
if (Test-Path "deployment_package") { 
    Remove-Item -Recurse -Force "deployment_package" 
    Write-Host "✅ 기존 deployment_package 폴더 삭제 완료" -ForegroundColor Yellow
}

# 3단계: React 앱 빌드
Write-Host "`n🔨 3단계: React 앱 빌드..." -ForegroundColor Cyan
npm run build
if ($LASTEXITCODE -eq 0) {
    Write-Host "✅ React 앱 빌드 완료" -ForegroundColor Green
} else {
    Write-Host "❌ React 앱 빌드 실패" -ForegroundColor Red
    exit 1
}

# 4단계: 배포 패키지 생성
Write-Host "`n📦 4단계: 배포 패키지 생성..." -ForegroundColor Cyan
New-Item -ItemType Directory -Path "deployment_package" -Force | Out-Null
Copy-Item -Path "build\*" -Destination "deployment_package\" -Recurse -Force

# PHP 백엔드 파일 복사
$phpFiles = @("secure-api-proxy.php", "api-proxy.php", "config.php", "rate-limiter.php", "test-api.php")
foreach ($file in $phpFiles) {
    if (Test-Path $file) {
        Copy-Item -Path $file -Destination "deployment_package\"
    }
}

# .htaccess 파일 복사
if (Test-Path ".htaccess_fixed") {
    Copy-Item -Path ".htaccess_fixed" -Destination "deployment_package\.htaccess"
}

Write-Host "✅ 배포 패키지 생성 완료" -ForegroundColor Green

# 5단계: 배포 패키지 검증
Write-Host "`n🔍 5단계: 배포 패키지 검증..." -ForegroundColor Cyan
$packageFiles = Get-ChildItem "deployment_package" -Recurse
Write-Host "📁 총 파일 수: $($packageFiles.Count)" -ForegroundColor Cyan
Write-Host "📊 주요 파일들:" -ForegroundColor Cyan
$packageFiles | Where-Object { $_.Name -match "\.(html|js|css|php)$" } | Select-Object Name, Length | Format-Table

Write-Host "`n🎉 배포 준비 완료!" -ForegroundColor Green
Write-Host "📦 deployment_package 폴더의 모든 파일을 서버에 업로드하세요." -ForegroundColor Cyan
Write-Host "🌐 업로드 후 https://edgeenglish.net/test-api.php 접속하여 테스트하세요." -ForegroundColor Cyan
```

### 1단계: React 앱 빌드 (수동)

#### 1.1 환경 변수 설정 후 빌드
```powershell
# 환경 변수 설정
$env:REACT_APP_API_PROXY_URL="https://edgeenglish.net/secure-api-proxy.php"
$env:REACT_APP_FIREBASE_API_KEY="AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo"
$env:REACT_APP_FIREBASE_AUTH_DOMAIN="edgeenglishlab.firebaseapp.com"
$env:REACT_APP_FIREBASE_PROJECT_ID="edgeenglishlab"
$env:REACT_APP_FIREBASE_STORAGE_BUCKET="edgeenglishlab.firebasestorage.app"
$env:REACT_APP_FIREBASE_MESSAGING_SENDER_ID="13831715924"
$env:REACT_APP_FIREBASE_APP_ID="1:13831715924:web:41907bce49707865e981c1"

# 빌드 실행
npm run build
```

#### 1.2 빌드 과정
1. **의존성 확인**: package.json의 모든 의존성 확인
2. **TypeScript 컴파일**: .tsx, .ts 파일을 JavaScript로 변환
3. **API 프록시 설정**: openaiProxyService를 통한 안전한 API 호출
4. **콘솔 로그 비활성화**: 프로덕션 환경에서 자동으로 콘솔 로그 비활성화
5. **번들링**: 모든 파일을 하나의 JS 파일로 번들링
6. **최적화**: 코드 압축 및 최적화
7. **정적 파일 복사**: public 폴더의 파일들을 build 폴더로 복사

### 2단계: 배포 패키지 생성

#### 2.1 자동화 스크립트 실행 (권장)
```powershell
# 배포 패키지 자동 생성 스크립트
Write-Host "🚀 배포 패키지 생성 시작..." -ForegroundColor Green

# 1. 기존 폴더 정리
if (Test-Path "deployment_package") { 
    Remove-Item -Recurse -Force "deployment_package" 
    Write-Host "✅ 기존 deployment_package 폴더 삭제 완료" -ForegroundColor Yellow
}

# 2. deployment_package 폴더 생성
New-Item -ItemType Directory -Path "deployment_package" -Force | Out-Null
Write-Host "✅ deployment_package 폴더 생성 완료" -ForegroundColor Green

# 3. React 빌드 파일 복사
if (Test-Path "build") {
    Copy-Item -Path "build\*" -Destination "deployment_package\" -Recurse -Force
    Write-Host "✅ React 빌드 파일 복사 완료" -ForegroundColor Green
} else {
    Write-Host "❌ build 폴더가 없습니다. 먼저 npm run build를 실행하세요." -ForegroundColor Red
    exit 1
}

# 4. PHP 백엔드 파일 복사
$phpFiles = @(
    "secure-api-proxy.php",
    "api-proxy.php", 
    "config.php",
    "rate-limiter.php",
    "test-api.php"
)

foreach ($file in $phpFiles) {
    if (Test-Path $file) {
        Copy-Item -Path $file -Destination "deployment_package\"
        Write-Host "✅ $file 복사 완료" -ForegroundColor Green
    } else {
        Write-Host "⚠️ $file 파일이 없습니다." -ForegroundColor Yellow
    }
}

# 5. .htaccess 파일 복사
if (Test-Path ".htaccess_fixed") {
    Copy-Item -Path ".htaccess_fixed" -Destination "deployment_package\.htaccess"
    Write-Host "✅ .htaccess 파일 복사 완료" -ForegroundColor Green
} else {
    Write-Host "⚠️ .htaccess_fixed 파일이 없습니다." -ForegroundColor Yellow
}

# 6. 배포 패키지 구조 확인
Write-Host "`n📁 배포 패키지 구조:" -ForegroundColor Cyan
dir deployment_package | Format-Table Name, Length, LastWriteTime

Write-Host "`n🎉 배포 패키지 생성 완료!" -ForegroundColor Green
Write-Host "📦 deployment_package 폴더의 모든 파일을 서버에 업로드하세요." -ForegroundColor Cyan
```

#### 2.2 수동 배포 패키지 생성
```powershell
# 수동으로 배포 패키지 생성하는 경우
New-Item -ItemType Directory -Path "deployment_package" -Force
Copy-Item -Path "build\*" -Destination "deployment_package\" -Recurse -Force
Copy-Item -Path "secure-api-proxy.php" -Destination "deployment_package\"
Copy-Item -Path "api-proxy.php" -Destination "deployment_package\"
Copy-Item -Path "config.php" -Destination "deployment_package\"
Copy-Item -Path "rate-limiter.php" -Destination "deployment_package\"
Copy-Item -Path "test-api.php" -Destination "deployment_package\"
Copy-Item -Path ".htaccess_fixed" -Destination "deployment_package\.htaccess"
```

#### 2.3 배포 패키지 구조 확인
```powershell
# deployment_package 폴더 구조 확인
dir deployment_package
```

**예상 배포 패키지 구조:**
```
deployment_package/
├── index.html                    (React 앱 메인)
├── favicon.ico                   (파비콘)
├── logo.png                     (로고)
├── howtowork.png                (도움말 이미지)
├── asset-manifest.json          (빌드 매니페스트)
├── .htaccess                    (Apache 설정)
├── secure-api-proxy.php         (보안 API 프록시)
├── api-proxy.php                (기본 API 프록시)
├── config.php                   (서버 설정)
├── rate-limiter.php             (요청 제한)
├── test-api.php                 (API 테스트)
└── static/
    ├── css/
    │   ├── main.xxxxx.css
    │   └── main.xxxxx.css.map
    └── js/
        ├── main.xxxxx.js
        ├── main.xxxxx.js.LICENSE.txt
        └── main.xxxxx.js.map
```

### 3단계: 서버 업로드

#### 3.1 dothome.co.kr 관리자 패널 접속
1. **dothome.co.kr** 로그인
2. **웹호스팅 관리** → **파일관리자** 접속
3. **public_html** 폴더로 이동

#### 3.2 파일 업로드 방법

**방법 1: 파일 매니저를 통한 업로드 (권장)**
1. **deployment_package** 폴더의 **모든 파일**을 선택
2. **public_html** 폴더에 업로드
3. 업로드 완료 후 파일 권한 확인

**방법 2: FTP 클라이언트 사용**
1. FTP 클라이언트 (FileZilla, WinSCP 등) 실행
2. dothome.co.kr FTP 정보로 연결
3. **deployment_package** 폴더의 모든 파일을 **public_html** 폴더에 업로드

**방법 3: ZIP 파일 업로드 후 압축 해제**
1. **deployment_package** 폴더를 ZIP으로 압축
2. ZIP 파일을 **public_html** 폴더에 업로드
3. 파일 매니저에서 ZIP 파일 압축 해제

#### 3.3 서버 환경 변수 설정
**dothome.co.kr 관리자 패널에서:**
1. **웹호스팅 관리** → **환경변수 설정**
2. 다음 환경 변수 추가:
   ```
   OPENAI_API_KEY=YOUR_OPENAI_API_KEY_HERE
   API_RATE_LIMIT=300
   API_TIMEOUT=60
   ALLOWED_ORIGINS=https://edgeenglish.net,https://www.edgeenglish.net
   LOG_FILE=api_logs.txt
   RATE_LIMIT_STORAGE_FILE=rate_limit.json
   ```

#### 3.4 파일 권한 설정
**업로드 후 다음 파일들의 권한을 확인:**
- **PHP 파일들**: 644 권한
- **.htaccess**: 644 권한
- **폴더들**: 755 권한
- **로그 파일들**: 666 권한 (쓰기 가능)

#### 3.5 업로드 완료 확인
**업로드 후 다음 파일들이 존재하는지 확인:**
- `public_html/index.html`
- `public_html/secure-api-proxy.php`
- `public_html/.htaccess`
- `public_html/static/js/main.*.js`
- `public_html/static/css/main.*.css`

### 4단계: 배포 후 테스트

#### 4.1 API 프록시 서버 테스트
1. **브라우저에서 접속**: `https://edgeenglish.net/test-api.php`
2. **예상 결과**: "API 연결 성공!" 메시지와 OpenAI 모델 목록 표시
3. **실패 시**: 서버 환경 변수 설정 확인

#### 4.2 React 앱 접속 테스트
1. **메인 사이트 접속**: `https://edgeenglish.net/`
2. **예상 결과**: React 앱이 정상적으로 로드됨
3. **라우팅 테스트**: 각 페이지 간 이동이 정상 작동하는지 확인

#### 4.3 AI 기능 테스트
1. **문제 생성 기능**: 영어 본문 입력 후 문제 생성
2. **이미지 업로드**: 캡처 이미지 업로드 후 텍스트 변환
3. **번역 기능**: 영어 텍스트 한글 번역
4. **콘솔 확인**: 개발자 도구에서 오류 메시지 없음 확인

#### 4.4 보안 기능 테스트
1. **Rate Limiting**: 연속으로 여러 요청을 보내서 429 에러 확인
2. **CORS 정책**: 다른 도메인에서 접속 시 차단 확인
3. **API Key 보호**: 개발자 도구에서 API Key 노출 없음 확인

#### 4.5 문제 해결 가이드
**500 Internal Server Error 발생 시:**
1. `.htaccess` 파일 임시 제거
2. `test-api.php` 접속 테스트
3. 문제 해결 후 `.htaccess` 파일 복원

**API 연결 실패 시:**
1. 서버 환경 변수 설정 확인
2. `api_logs.txt` 파일에서 오류 로그 확인
3. `rate_limit.json` 파일에서 요청 제한 확인

## 🔍 배포 검증

### 1. API 프록시 설정 확인

```powershell
# 빌드된 JS 파일에서 API 프록시 URL 확인
findstr /i "secure-api-proxy" build\static\js\main.*.js
```

**예상 결과**: `https://edgeenglish.net/secure-api-proxy.php` 포함

### 2. Firebase 설정 확인

```powershell
# Firebase 설정 확인
findstr /i "firebase" build\static\js\main.*.js
```

### 3. 콘솔 로그 비활성화 확인

```powershell
# 빌드된 JS 파일에서 콘솔 로그 확인
findstr /i "console\.log" build\static\js\main.*.js
```

**예상 결과**: 콘솔 로그가 비활성화되어 있어야 함 (빈 결과 또는 최소한의 로그만 남음)

### 4. 보안 확인

**중요**: 빌드된 JS 파일에서 OpenAI API Key가 **포함되지 않아야** 함
```powershell
# API Key 누출 확인 (결과가 없어야 정상)
findstr /i "sk-proj-" build\static\js\main.*.js
```

**예상 결과**: 빈 결과 (API Key가 클라이언트에 노출되지 않음)

### 5. 배포 패키지 완성도 확인

```powershell
# 배포 패키지 파일 목록 확인
dir deployment_package

# 주요 파일 존재 확인
$requiredFiles = @(
    "index.html",
    "secure-api-proxy.php",
    "config.php",
    "rate-limiter.php",
    "test-api.php",
    ".htaccess"
)

foreach ($file in $requiredFiles) {
    if (Test-Path "deployment_package\$file") {
        Write-Host "✅ $file 존재" -ForegroundColor Green
    } else {
        Write-Host "❌ $file 누락" -ForegroundColor Red
    }
}
```

### 6. 서버 업로드 후 검증

**업로드 완료 후 다음 URL들을 순서대로 테스트:**

1. **API 프록시 테스트**: `https://edgeenglish.net/test-api.php`
2. **React 앱 메인**: `https://edgeenglish.net/`
3. **React 라우팅**: `https://edgeenglish.net/` → 각 페이지 이동 테스트
4. **AI 기능**: 문제 생성, 이미지 업로드, 번역 기능 테스트

## 📦 배포 패키지 상세

### 1. React 앱 파일 (정적 파일)

- ✅ `index.html` - React SPA 메인 파일
- ✅ `static/js/main.*.js` - JavaScript 번들 (API 프록시 포함)
- ✅ `static/css/main.*.css` - CSS 스타일시트
- ✅ `favicon.ico` - 파비콘
- ✅ `logo.png` - 로고 이미지
- ✅ `howtowork.png` - 도움말 이미지
- ✅ `asset-manifest.json` - 빌드 매니페스트

### 2. PHP 백엔드 파일 (서버 측)

- ✅ `secure-api-proxy.php` - 보안 API 프록시 (메인)
- ✅ `api-proxy.php` - 기본 API 프록시 (백업)
- ✅ `config.php` - 서버 설정 파일
- ✅ `rate-limiter.php` - 요청 제한 클래스
- ✅ `test-api.php` - API 연결 테스트
- ✅ `.htaccess` - Apache 서버 설정

### 3. 파일 크기 최적화

**정상적인 파일 크기:**
- **JS 번들**: ~350KB (gzip 압축)
- **CSS 파일**: ~35KB (gzip 압축)
- **PHP 파일**: ~15KB (총합)
- **이미지 파일**: 최적화됨
- **콘솔 로그**: 프로덕션 환경에서 완전 비활성화

### 4. 배포 패키지 생성 스크립트

```powershell
# 🚀 edgeenglish.net 배포 패키지 생성 스크립트
Write-Host "🚀 edgeenglish.net 배포 패키지 생성 시작..." -ForegroundColor Green

# 1. 기존 폴더 정리
if (Test-Path "deployment_package") { 
    Remove-Item -Recurse -Force "deployment_package" 
    Write-Host "✅ 기존 deployment_package 폴더 삭제 완료" -ForegroundColor Yellow
}

# 2. deployment_package 폴더 생성
New-Item -ItemType Directory -Path "deployment_package" -Force | Out-Null
Write-Host "✅ deployment_package 폴더 생성 완료" -ForegroundColor Green

# 3. React 빌드 파일 복사
if (Test-Path "build") {
    Copy-Item -Path "build\*" -Destination "deployment_package\" -Recurse -Force
    Write-Host "✅ React 빌드 파일 복사 완료" -ForegroundColor Green
} else {
    Write-Host "❌ build 폴더가 없습니다. 먼저 npm run build를 실행하세요." -ForegroundColor Red
    exit 1
}

# 4. PHP 백엔드 파일 복사
$phpFiles = @(
    "secure-api-proxy.php",
    "api-proxy.php", 
    "config.php",
    "rate-limiter.php",
    "test-api.php"
)

foreach ($file in $phpFiles) {
    if (Test-Path $file) {
        Copy-Item -Path $file -Destination "deployment_package\"
        Write-Host "✅ $file 복사 완료" -ForegroundColor Green
    } else {
        Write-Host "⚠️ $file 파일이 없습니다." -ForegroundColor Yellow
    }
}

# 5. .htaccess 파일 복사
if (Test-Path ".htaccess_fixed") {
    Copy-Item -Path ".htaccess_fixed" -Destination "deployment_package\.htaccess"
    Write-Host "✅ .htaccess 파일 복사 완료" -ForegroundColor Green
} else {
    Write-Host "⚠️ .htaccess_fixed 파일이 없습니다." -ForegroundColor Yellow
}

# 6. 배포 패키지 구조 확인
Write-Host "`n📁 배포 패키지 구조:" -ForegroundColor Cyan
dir deployment_package | Format-Table Name, Length, LastWriteTime

Write-Host "`n🎉 배포 패키지 생성 완료!" -ForegroundColor Green
Write-Host "📦 deployment_package 폴더의 모든 파일을 서버에 업로드하세요." -ForegroundColor Cyan
```

## 🔧 배포 후 확인사항

### 1. API 프록시 서버 테스트

- [ ] `https://edgeenglish.net/test-api.php` 접속 성공
- [ ] OpenAI 모델 목록 표시 확인
- [ ] 서버 환경 변수 정상 작동 확인

### 2. React 앱 기본 기능 테스트

- [ ] 홈페이지 로딩 확인 (`https://edgeenglish.net/`)
- [ ] React Router 정상 작동 (페이지 새로고침 시에도 정상)
- [ ] 로그인/회원가입 기능 확인
- [ ] 네비게이션 메뉴 작동 확인

### 3. AI 기능 테스트

- [ ] 영어 본문 입력 후 문제 생성 기능
- [ ] 캡처 이미지 업로드 후 텍스트 변환
- [ ] 번역 기능 정상 작동
- [ ] 개발자 콘솔에서 오류 메시지 없음 확인
- [ ] API Key 노출 없음 확인

### 4. 보안 기능 테스트

- [ ] Rate Limiting 정상 작동 (시간당 300회 제한)
- [ ] CORS 정책 정상 작동
- [ ] 로그 파일 생성 확인 (`api_logs.txt`)
- [ ] Rate Limit 데이터 파일 생성 확인 (`rate_limit.json`)

### 5. 인쇄 기능 테스트

- [ ] 각 유형별 문제 생성 후 인쇄 미리보기 확인
- [ ] 페이지 분할 로직 정상 작동 확인
- [ ] A4 템플릿 정상 렌더링 확인

## 🚀 빠른 배포 가이드

### 전체 배포 과정 (5분 완료)

```powershell
# 1. 환경 변수 설정 및 빌드
$env:REACT_APP_API_PROXY_URL="https://edgeenglish.net/secure-api-proxy.php"
$env:REACT_APP_FIREBASE_API_KEY="AIzaSyDQJynQZGn3TomGEMtZYSGQrYlvO7CApNo"
$env:REACT_APP_FIREBASE_AUTH_DOMAIN="edgeenglishlab.firebaseapp.com"
$env:REACT_APP_FIREBASE_PROJECT_ID="edgeenglishlab"
$env:REACT_APP_FIREBASE_STORAGE_BUCKET="edgeenglishlab.firebasestorage.app"
$env:REACT_APP_FIREBASE_MESSAGING_SENDER_ID="13831715924"
$env:REACT_APP_FIREBASE_APP_ID="1:13831715924:web:41907bce49707865e981c1"

# 2. 빌드 실행
npm run build

# 3. 배포 패키지 생성
New-Item -ItemType Directory -Path "deployment_package" -Force | Out-Null
Copy-Item -Path "build\*" -Destination "deployment_package\" -Recurse -Force
Copy-Item -Path "secure-api-proxy.php" -Destination "deployment_package\"
Copy-Item -Path "api-proxy.php" -Destination "deployment_package\"
Copy-Item -Path "config.php" -Destination "deployment_package\"
Copy-Item -Path "rate-limiter.php" -Destination "deployment_package\"
Copy-Item -Path "test-api.php" -Destination "deployment_package\"
Copy-Item -Path ".htaccess_fixed" -Destination "deployment_package\.htaccess"

# 4. 배포 패키지 확인
dir deployment_package
```

### 서버 업로드 후 테스트

1. **API 테스트**: `https://edgeenglish.net/test-api.php`
2. **메인 사이트**: `https://edgeenglish.net/`
3. **AI 기능**: 문제 생성, 이미지 업로드, 번역 테스트

## ⚠️ 주의사항

### 1. 보안 고려사항

**새로운 아키텍처의 장점:**
- ✅ **API Key 서버 측 보호**: 클라이언트에 노출되지 않음
- ✅ **Rate Limiting**: 시간당 300회 요청 제한으로 남용 방지
- ✅ **CORS 정책**: 허용된 도메인만 접근 가능
- ✅ **입력 검증**: 모든 API 요청 검증 및 필터링

**보안 모니터링:**
- `api_logs.txt` 파일을 통한 실시간 로그 모니터링
- `rate_limit.json` 파일을 통한 사용량 추적
- 정기적인 로그 파일 검토 및 정리

### 2. 서버 환경 변수 관리

**중요한 설정:**
- `OPENAI_API_KEY`: 서버에서만 설정, 클라이언트에 노출 금지
- `API_RATE_LIMIT`: 시간당 요청 제한 (기본값: 300)
- `ALLOWED_ORIGINS`: 허용된 도메인 목록

**환경 변수 변경 시:**
- dothome.co.kr 관리자 패널에서 환경 변수 수정
- 서버 재시작 또는 캐시 클리어 필요할 수 있음

### 3. 콘솔 로그 비활성화

**자동 비활성화:**
- 프로덕션 빌드에서 모든 콘솔 메서드가 자동으로 비활성화됨
- `console.log()`, `console.warn()`, `console.error()` 등 모든 메서드 비활성화
- 개발자 도구에서 로그 메시지가 표시되지 않음

**개발 환경:**
- 개발 모드(`npm start`)에서는 콘솔 로그가 정상 작동
- 프로덕션 빌드(`npm run build`)에서만 비활성화

### 4. 성능 최적화

- **이미지 최적화**: 필요시 이미지 압축
- **PHP 캐싱**: 서버 측 캐싱 활용
- **캐시 설정**: 브라우저 캐시 최적화
- **Rate Limiting**: 서버 부하 방지

### 5. 업데이트 시 주의사항

**React 앱 업데이트:**
- 소스 코드 수정 후 재빌드 및 재배포 필요
- 환경 변수 변경 시 재빌드 필요
- 의존성 업데이트 시 재빌드 필요

**PHP 백엔드 업데이트:**
- PHP 파일 수정 시 서버에 직접 업로드
- 환경 변수 변경 시 서버 재시작 필요할 수 있음
- `.htaccess` 파일 수정 시 문법 오류 주의

### 6. 백업 및 복구

**정기적인 백업:**
- `deployment_package` 폴더 전체 백업
- 서버 환경 변수 설정 백업
- 로그 파일 정기적 백업

**문제 발생 시 복구:**
- `.htaccess` 파일 임시 제거로 500 에러 해결
- `test-api.php`로 API 연결 상태 확인
- 로그 파일을 통한 문제 진단

## 🚨 문제 해결

### 1. 빌드 실패 시

```bash
# 의존성 재설치
npm install

# 캐시 정리
npm start -- --reset-cache

# node_modules 삭제 후 재설치
rmdir /s /q node_modules
npm install
```

### 2. API 프록시 연결 실패 시

#### 2.1 test-api.php 접속 불가
- **원인**: 서버 환경 변수 미설정
- **해결**: dothome.co.kr 관리자 패널에서 환경 변수 설정

#### 2.2 500 Internal Server Error
- **원인**: .htaccess 파일 문법 오류
- **해결**: 
  1. `.htaccess` 파일 임시 제거
  2. `test-api.php` 접속 테스트
  3. `.htaccess_fixed` 파일을 `.htaccess`로 업로드

#### 2.3 CORS 오류
- **원인**: 허용되지 않은 도메인에서 접속
- **해결**: `config.php`에서 `ALLOWED_ORIGINS` 확인

### 3. React 앱 로딩 실패 시

#### 3.1 404 오류 (페이지 새로고침 시)
- **원인**: .htaccess 설정 문제
- **해결**: `.htaccess` 파일에 React Router 설정 확인

#### 3.2 API 호출 실패
- **원인**: API 프록시 URL 설정 오류
- **해결**: 환경 변수 `REACT_APP_API_PROXY_URL` 확인

### 4. 콘솔 로그가 여전히 표시되는 경우

```bash
# disableConsole.js 파일이 올바르게 생성되었는지 확인
dir src\utils\disableConsole.js

# App.tsx에서 import가 올바른지 확인
findstr /i "disableConsole" src\App.tsx
```

**해결 방법:**
- `src/utils/disableConsole.js` 파일이 존재하는지 확인
- `src/App.tsx`에서 `import './utils/disableConsole';`가 포함되어 있는지 확인
- 프로덕션 빌드(`npm run build`)를 다시 실행

### 5. 보안 관련 문제

#### 5.1 API Key 노출 확인
```bash
# 빌드된 파일에서 API Key 검색 (결과가 없어야 정상)
findstr /i "sk-proj-" build\static\js\main.*.js
```

#### 5.2 Rate Limit 초과
- **증상**: 429 Too Many Requests 오류
- **해결**: 시간당 300회 제한 확인, 필요시 `config.php`에서 조정

### 6. 성능 문제

#### 6.1 느린 응답 시간
- **원인**: OpenAI API 응답 지연
- **해결**: `config.php`에서 `API_TIMEOUT` 조정

#### 6.2 메모리 부족
- **원인**: Rate Limit 데이터 파일 크기 증가
- **해결**: 정기적인 `rate_limit.json` 파일 정리

## 📝 배포 체크리스트

### 1단계: 빌드 전 준비
- [ ] 환경 변수 설정 완료 (`REACT_APP_API_PROXY_URL` 포함)
- [ ] 기존 빌드 폴더 정리
- [ ] 의존성 설치 완료
- [ ] 콘솔 로그 비활성화 설정 확인

### 2단계: React 앱 빌드
- [ ] 빌드 성공 확인
- [ ] 경고 메시지 검토 (무시 가능)
- [ ] 파일 크기 확인 (JS: ~350KB, CSS: ~35KB)
- [ ] API 프록시 URL 포함 확인

### 3단계: 배포 패키지 생성
- [ ] `deployment_package` 폴더 생성
- [ ] React 빌드 파일 복사
- [ ] PHP 백엔드 파일 복사
- [ ] `.htaccess` 파일 포함

### 4단계: 서버 업로드
- [ ] dothome.co.kr 관리자 패널 접속
- [ ] `public_html` 폴더에 파일 업로드
- [ ] 서버 환경 변수 설정
- [ ] 파일 권한 확인

### 5단계: 배포 후 테스트
- [ ] `test-api.php` 접속 성공
- [ ] React 앱 메인 페이지 로딩
- [ ] AI 기능 테스트 (문제 생성, 이미지 업로드)
- [ ] 콘솔 오류 없음 확인
- [ ] API Key 노출 없음 확인

### 6단계: 보안 검증
- [ ] API Key가 클라이언트에 노출되지 않음
- [ ] Rate Limiting 정상 작동
- [ ] CORS 설정 확인
- [ ] 로그 파일 생성 확인

## 📞 지원

배포 과정에서 문제가 발생하면:

1. **API 프록시 테스트**: `https://edgeenglish.net/test-api.php` 접속 확인
2. **콘솔 오류 확인**: 브라우저 개발자 도구에서 오류 메시지 확인
3. **서버 로그 확인**: `api_logs.txt` 파일에서 서버 측 오류 확인
4. **환경 변수 재확인**: dothome.co.kr 관리자 패널에서 환경 변수 설정 확인
5. **.htaccess 문제**: 500 에러 시 `.htaccess` 파일 임시 제거 후 테스트

## 🆕 최신 업데이트 (2025-09-30)

### 새로운 아키텍처
- ✅ **PHP API 프록시 서버**: OpenAI API Key 서버 측 보호
- ✅ **보안 강화**: Rate Limiting, CORS, 입력 검증
- ✅ **클라이언트 보안**: API Key 클라이언트 노출 방지
- ✅ **콘솔 로그 비활성화**: 프로덕션 환경에서 완전 비활성화

### 배포 패키지
- **React SPA**: 정적 파일 (HTML, CSS, JS)
- **PHP 백엔드**: API 프록시, 설정, 보안 파일
- **Apache 설정**: .htaccess 파일
- **총 파일 수**: ~15개 (React 빌드 + PHP 백엔드)

### 보안 기능
- **API Key 보호**: 서버 측에서만 사용
- **Rate Limiting**: 시간당 300회 요청 제한
- **CORS 정책**: 허용된 도메인만 접근 가능
- **입력 검증**: 모든 API 요청 검증
- **로깅**: 모든 API 호출 기록

---

**마지막 업데이트**: 2025-09-30
**문서 버전**: 3.0
**적용 환경**: dothome.co.kr (Apache + PHP)
**주요 기능**: PHP API 프록시 서버 + React SPA
